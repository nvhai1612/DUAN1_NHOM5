﻿CREATE DATABASE DUAN1_NHOM5
DROP DATABASE DUAN1_NHOM5
USE DUAN1_NHOM5

IF OBJECT_ID ('CHUCVU') IS NOT NULL
DROP TABLE CHUCVU
CREATE TABLE CHUCVU(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   MACV VARCHAR(20),
	   TENCV NVARCHAR(MAX)
)

IF OBJECT_ID ('NHANVIEN') IS NOT NULL
DROP TABLE NHANVIEN
CREATE TABLE NHANVIEN(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   MANV VARCHAR(20),
	   TENNV NVARCHAR(MAX),
	   GIOITINH INT,
	   NGAYSINH DATE,
	   CCCD VARCHAR(13),
	   DIACHI NVARCHAR(MAX),
	   SDT VARCHAR(12),
	   EMAIL VARCHAR(MAX),
	   MATKHAU VARCHAR(MAX),
	   TRANGTHAINV INT,
	   IDCV UNIQUEIDENTIFIER,

	   FOREIGN KEY (IDCV) REFERENCES CHUCVU(ID)
)

IF OBJECT_ID ('MAUSAC') IS NOT NULL
DROP TABLE MAUSAC
CREATE TABLE MAUSAC(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   MAMS VARCHAR(20),
	   TENMS NVARCHAR(MAX),
	   TRANGTHAIMS INT,
)

IF OBJECT_ID ('CHATLIEU') IS NOT NULL
DROP TABLE CHATLIEU
CREATE TABLE CHATLIEU(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   MACL VARCHAR(20),
	   TENCL NVARCHAR(MAX),
	   TRANGTHAICL INT
)

IF OBJECT_ID ('THUONGHIEU') IS NOT NULL
DROP TABLE THUONGHIEU
CREATE TABLE THUONGHIEU(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   MATH VARCHAR(20),
	   TENTH NVARCHAR(MAX),
	   TRANGTHAITH INT
)

IF OBJECT_ID ('KICHCO') IS NOT NULL
DROP TABLE KICHCO
CREATE TABLE KICHCO(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   MAKC VARCHAR(20),
	   TENKC NVARCHAR(MAX),
	   TRANGTHAIKC INT
)

IF OBJECT_ID ('SANPHAM') IS NOT NULL
DROP TABLE SANPHAM
CREATE TABLE SANPHAM(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   MASP VARCHAR(20),
	   TENSP NVARCHAR(MAX),
	   TRANGTHAISP INT,
)

IF OBJECT_ID ('KHUYENMAI') IS NOT NULL
DROP TABLE KHUYENMAI
CREATE TABLE KHUYENMAI(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   IDSP UNIQUEIDENTIFIER,
	   MAKM VARCHAR(20),
	   TENKM NVARCHAR(MAX),
	   MUCGIAMGIA FLOAT,
	   THOIGIANBATDAU DATE,
	   THOIGIANKETTHUC DATE,
	   TRANGTHAIKM INT,
	   SOLUONG INT,

	   FOREIGN KEY (IDSP) REFERENCES SANPHAM(ID)
)

IF OBJECT_ID ('SANPHAMCHITIET') IS NOT NULL
DROP TABLE SANPHAMCHITIET
CREATE TABLE SANPHAMCHITIET(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   IDMS UNIQUEIDENTIFIER,
	   IDCL UNIQUEIDENTIFIER,
	   IDTH UNIQUEIDENTIFIER,
	   IDKC UNIQUEIDENTIFIER,
	   IDSP UNIQUEIDENTIFIER,
	   MASPCT VARCHAR(20),
	   NGUOITAO NVARCHAR(50),
	   SOLUONGTON INT,
	   MOTA NVARCHAR(MAX),
	   TRANGTHAISPCT INT,
	   DONGIA FLOAT,

	   FOREIGN KEY (IDMS) REFERENCES MAUSAC(ID),
	   FOREIGN KEY (IDCL) REFERENCES CHATLIEU(ID),
	   FOREIGN KEY (IDTH) REFERENCES THUONGHIEU(ID),
	   FOREIGN KEY (IDKC) REFERENCES KICHCO(ID),
	   FOREIGN KEY (IDSP) REFERENCES SANPHAM(ID),
)

IF OBJECT_ID ('KHUYENMAICHITIET') IS NOT NULL
DROP TABLE KHUYENMAICHITIET
CREATE TABLE KHUYENMAICHITIET(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   IDKM UNIQUEIDENTIFIER,
	   IDSPCT UNIQUEIDENTIFIER,
	   MAKMCT VARCHAR(20),
	   TRANGTHAIKMCT INT,

	   FOREIGN KEY (IDKM) REFERENCES KHUYENMAI(ID),
	   FOREIGN KEY (IDSPCT) REFERENCES SANPHAMCHITIET(ID),
)

IF OBJECT_ID ('KHACHHANG') IS NOT NULL
DROP TABLE KHACHHANG
CREATE TABLE KHACHHANG(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   MAKH VARCHAR(20),
	   TENKH NVARCHAR(MAX),
	   NGAYSINH DATE,
	   GIOITINH BIT,
	   SDT VARCHAR(12),
	   DIACHI NVARCHAR(MAX),
)

IF OBJECT_ID ('HOADON') IS NOT NULL
DROP TABLE HOADON
CREATE TABLE HOADON(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   IDKH UNIQUEIDENTIFIER,
	   IDNV UNIQUEIDENTIFIER,
	   MAHD VARCHAR(20),
	   NGAYTAO DATETIME,
	   NGAYTHANHTOAN DATE,
	   TONGTIEN FLOAT,
	   TRANGTHAIHD INT,

	   FOREIGN KEY (IDKH) REFERENCES KHACHHANG(ID),
	   FOREIGN KEY (IDNV) REFERENCES NHANVIEN(ID),
)

IF OBJECT_ID ('HOADONCT') IS NOT NULL
DROP TABLE HOADONCT
CREATE TABLE HOADONCT(
	   ID UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	   IDHD UNIQUEIDENTIFIER,
	   IDSPCT UNIQUEIDENTIFIER,
	   MAHDCT VARCHAR(20),
	   NGAYTAO DATETIME,
	   DONGIA FLOAT,
	   DONGIASAUKHIGIAM FLOAT,
	   SOLUONG INT,

	   FOREIGN KEY (IDHD) REFERENCES HOADON(ID),
	   FOREIGN KEY (IDSPCT) REFERENCES SANPHAMCHITIET(ID),
)

--INSERT TAIKHOAN
INSERT INTO CHUCVU (MACV,TENCV) VALUES
('CV01',N'Quản lý'),
('CV02',N'Nhân viên')


-- INSERT NHANVIEN
INSERT INTO NHANVIEN (MANV,TENNV,GIOITINH,NGAYSINH,CCCD,DIACHI,SDT,EMAIL,MATKHAU,TRANGTHAINV,IDCV) VALUES
('NV01',N'Nguyễn Văn Hải',1,'12/16/2003','001203030101',N'Hà Nội','0327213548','nvhai1612@gmail.com','16122003',1,'36289EB6-0C44-4562-982F-5714E3E01A1B'),
('NV02',N'Nguyễn Thị Nhung',0,'01/20/2000','001203987617',N'Thạch Thất','0962474048','nhungnt0801@gmail.com','456789',1,'36289EB6-0C44-4562-982F-5714E3E01A1B'),
('NV03',N'Nguyễn Bích Ngọc',0,'03/09/2004','001298768787',N'Thái Bình','0346567677','ngocnt@gmail.com','123456',0,'BF69ACFD-0346-435A-A835-54F758BAF969'),
('NV04',N'Nguyễn Văn Tùng',1,'05/11/2003','001202098789',N'Đông Anh','0976541482','tungnv0976541482@gmail.com','123456',1,'BF69ACFD-0346-435A-A835-54F758BAF969'),
('NV05',N'Bùi Vũ Hoàng',1,'06/22/2002','001202098789',N'Nghệ An','0976541482','hoangbv@gmail.com','123456',0,'BF69ACFD-0346-435A-A835-54F758BAF969'),
('NV06',N'Nguyễn Bá Hiệp',1,'07/13/1999','001202098789',N'Quảng Ninh','0976541482','hiepnb@gmail.com','123456',1,'BF69ACFD-0346-435A-A835-54F758BAF969')


-- INSERT MAUSAC
INSERT INTO MAUSAC (MAMS,TENMS,TRANGTHAIMS) VALUES
('MS01',N'Xám',1),
('MS02',N'Đen',1),
('MS03',N'Trắng',1),
('MS04',N'Xanh',0),
('MS05',N'Hồng',1)


-- INSERT CHATLIEU
INSERT INTO CHATLIEU (MACL,TENCL,TRANGTHAICL) VALUES
('CL01',N'Kaki',1),
('CL02',N'Cotton',1),
('CL03',N'Polyester',1),
('CL04',N'Denim',1),
('CL05',N'Nano',0)


-- INSERT THUONGHIEU
INSERT INTO THUONGHIEU(MATH,TENTH,TRANGTHAITH) VALUES
('TH01',N'Denimst',1),
('TH02',N'Coolmate',1),
('TH03',N'Hussio',1),
('TH04',N'Pattern',1),
('TH05',N'SSStutter',1)


-- INSERT KICHCO
INSERT INTO KICHCO (MAKC,TENKC,TRANGTHAIKC) VALUES
('KC01',N'M',1),
('KC02',N'L',1),
('KC03',N'XL',1),
('KC04',N'XXL',1),
('KC05',N'XXXL',0)


-- INSERT SANPHAM
INSERT INTO SANPHAM (MASP,TENSP,TRANGTHAISP) VALUES
('SP01',N'Sơ mi cộc tay cổ bẻ',1),
('SP02',N'Sơ mi cộc tay cổ tàu',1),
('SP03',N'Sơ mi dài tay cổ bẻ',1),
('SP04',N'Sơ mi dài tay cổ tàu',1)


-- INSERT SPCT
INSERT INTO SANPHAMCHITIET (MASPCT,IDMS,IDCL,IDTH,IDKC,IDSP,NGUOITAO,SOLUONGTON,MOTA,TRANGTHAISPCT,DONGIA) VALUES
('SPCT01','2917F74A-064D-4760-BAAD-2E3EC3AD8B09','49DDE4CD-7615-4DED-9625-33A9B9D779EE',
'A79E1A86-652E-4AA5-804B-101E3298317E','D9CC5357-BD00-4397-A3D2-2D2FB14BF710',
'F9DF86B6-F18D-47AB-92DB-4482A42F5AF2',N'Nguyễn Văn Hải',100,N'chất liệu thoáng mát',1,800000),
('SPCT02','10152348-1FF1-495D-808E-3CC9874A84E8','15E43965-4EB5-4D65-9728-549EBBE5698A',
'6BD33C97-F323-4E24-8C84-49F638502DBA','0CE72144-FE06-403E-B8F1-4B3BE7497706',
'A5A22E6F-9D73-40EF-86AF-70F281FC59D5',N'Nguyễn Văn Hải',200,N'sang trọng, lịch lãm',1,700000),
('SPCT03','32586674-66D3-4557-998F-6EA470E2026B','18695E27-809C-4439-B58D-79FEDAE38904',
'D05BA78F-3ABB-44B4-B593-571796960A44','35DB83DE-954F-4E7C-BFFD-65815D26F3FB',
'24820C05-FCE4-416D-9A61-CE68F6B79AAC',N'Nguyễn Thị Nhung',300,N'trẻ trung, năng động',1,700000)


-- INSERT KHACHHANG
INSERT INTO KHACHHANG (MAKH,TENKH,NGAYSINH,GIOITINH,SDT,DIACHI) VALUES
('KH01',N'Nguyễn Cầu Giấy','12/09/2000',1,'0987878787',N'Sài Gòn'),
('KH02',N'Trần Thanh Xuân','08/09/1997',1,'0987678787',N'Hà Nội'),
('KH03',N'Lê Ba Đình','11/03/2003',0,'0347878787',N'Hà Nội')


-- INSERT KHUYENMAI
insert into KHUYENMAI (IDSP,MAKM,TENKM,MUCGIAMGIA,THOIGIANBATDAU,THOIGIANKETTHUC,TRANGTHAIKM,SOLUONG) values 
('F9DF86B6-F18D-47AB-92DB-4482A42F5AF2','KM01',N'Sale 11/11/2021',30,'11/11/2021','11/12/2021',0,500),
('A5A22E6F-9D73-40EF-86AF-70F281FC59D5','KM02',N'Sale 12/12/2021',10,'12/12/2021','12/13/2021',0,200),
('FDD63BFE-5F46-4F46-A909-A2B9388DDDC0','KM03',N'Sale 04/04/2024',20,'04/04/2025','04/04/2023',1,100)


-- INSERT KHUYENMAICHITIET
INSERT INTO KHUYENMAICHITIET (MAKMCT,IDKM,IDSPCT,TRANGTHAIKMCT) VALUES
('KMCT01','96F29A8B-F676-4C7A-8EF7-53D4BB5B0F81','13A25BDD-2490-49C8-AF9A-3A093A32A5B1',1),
('KMCT02','67E288CF-21DE-477F-9467-593DEC94E73D','6365C23A-8B89-4FB6-B18C-A9F3C8D1D4C6',0)


select * from CHUCVU
select MANV,TENNV,GIOITINH,NGAYSINH,CCCD,DIACHI,SDT,EMAIL,TRANGTHAINV from NHANVIEN
select * from MAUSAC
select * from CHATLIEU
select * from THUONGHIEU
select * from KICHCO
select * from SANPHAM
select * from KHUYENMAI
select * from SANPHAMCHITIET
select * from KHUYENMAICHITIET
select * from KHACHHANG
select * from HOADON
select * from HOADONCT

select hd.soluong from hoadonct hd join sanphamchitiet sp on hd.idspct = sp.id where sp.maspct = ?
delete from hoadonct where mahdct = '4505'
select hd.mahdct from hoadonct hd join sanphamchitiet sp on hd.idspct = sp.id where sp.maspct = 'SPCT03'
select mahdct from HOADONCT hd join SANPHAMCHITIET sp on hd.IDSPCT = sp.ID where sp.MASPCT = ?
SELECT MASPCT,TENSP,SOLUONGTON,NGUOITAO,TRANGTHAISPCT,TENCL,TENKC,TENMS,TENTH,DONGIA FROM SANPHAMCHITIET JOIN SANPHAM ON SANPHAMCHITIET.IDSP = SANPHAM.ID JOIN CHATLIEU ON SANPHAMCHITIET.IDCL = CHATLIEU.ID JOIN KICHCO ON SANPHAMCHITIET.IDKC = KICHCO.ID JOIN THUONGHIEU ON SANPHAMCHITIET.IDTH = THUONGHIEU.ID JOIN MAUSAC ON SANPHAMCHITIET.IDMS = MAUSAC.ID

SELECT * from HoaDon join NHANVIEN NV on HOADON.IDNV = NV.ID

SELECT * from HOADON INNER JOIN HOADONCT ON HOADON.ID = HOADONCT.IDHD INNER JOIN KHACHHANG ON HOADON.IDKH = KHACHHANG.ID INNER JOIN NHANVIEN ON HOADON.IDNV = NHANVIEN.ID


delete from hoadon
delete from hoadonct

update hoadon set TrangThaiHD = 1 where mahd = '8837'

SELECT MASPCT,TENSP,SOLUONGTON,IDCL,IDKC,IDMS,IDTH,DONGIA,SANPHAMCHITIET.id FROM SANPHAMCHITIET JOIN SANPHAM ON SANPHAMCHITIET.IDSP = SANPHAM.ID JOIN CHATLIEU ON SANPHAMCHITIET.IDCL = CHATLIEU.ID JOIN KICHCO ON SANPHAMCHITIET.IDKC = KICHCO.ID JOIN THUONGHIEU ON SANPHAMCHITIET.IDTH = THUONGHIEU.ID JOIN MAUSAC ON SANPHAMCHITIET.IDMS = MAUSAC.ID WHERE MASPCT = '9261'

SELECT MASPCT,TENSP,SOLUONG,SANPHAMCHITIET.DONGIA FROM HOADON INNER JOIN
                  HOADONCT ON HOADON.ID = HOADONCT.IDHD INNER JOIN
                  SANPHAMCHITIET ON HOADONCT.IDSPCT = SANPHAMCHITIET.ID Join
				  SANPHAM ON SANPHAMCHITIET.IDSP = SANPHAM.ID WHERE MAHD = '7414' 

select MaHD,IDKH,IDNV,h.TRANGTHAIHD,MASP,TENSP,SOLUONG,hc.DONGIA from hoadonct hc join hoadon h on h.id = hc.IDHD join SANPHAMCHITIET sc on sc.id = hc.IDSPCT join sanpham s on s.id = sc.IDSP

SELECT * FROM HOADON INNER JOIN HOADONCT ON HOADON.ID = HOADONCT.IDHD INNER JOIN KHACHHANG ON HOADON.IDKH = KHACHHANG.ID INNER JOIN NHANVIEN ON HOADON.IDNV = NHANVIEN.ID

SELECT * from HoaDon INNER join NHANVIEN n on hoadon.IDNV = n.id

SELECT TRANGTHAIHD , TONGTIEN from HoaDon where mahd = '5325'
SELECT * FROM HOADON INNER JOIN HOADONCT ON HOADON.ID = HOADONCT.IDHD INNER JOIN KHACHHANG ON HOADON.IDKH = KHACHHANG.ID INNER JOIN NHANVIEN ON HOADON.IDNV = NHANVIEN.ID

SELECT * FROM HOADON INNER JOIN NHANVIEN ON HOADON.IDNV = NHANVIEN.ID WHERE TRANGTHAIHD = '2'

select MAHD,IDNV,NGAYTAO,TRANGTHAIHD from HoaDon where TRANGTHAIHD = 1 order by TRANGTHAIHD asc

select hd.mahdct from hoadonct hd join sanphamchitiet sp on hd.idspct = sp.id join hoadon h on h.id = hd.idhd where sp.maspct = 'SPCT03' and h.mahd = '8837'

select MAHD,IDNV,NGAYTAO,TRANGTHAIHD from HoaDon where TRANGTHAIHD = 0 order by TRANGTHAIHD asc

SELECT * from HoaDon where mahd = '9261'

select hd.mahdct from hoadonct hd join sanphamchitiet sp on hd.idspct = sp.id join hoadon h on h.id = hd.idhd where sp.maspct = 'SPCT03' and h.mahd = '5378'